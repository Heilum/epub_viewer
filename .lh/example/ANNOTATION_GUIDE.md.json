{
    "sourceFile": "example/ANNOTATION_GUIDE.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1762661640555,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762661869795,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,11 +32,10 @@\n 定义了标注的数据模型：\n - `id`: 唯一标识符\n - `cfi`: EPUB CFI 位置信息\n - `type`: 标注类型（高亮/笔记）\n-  - `highlight`: 黄色背景高亮\n-  - `note`: 笔记（视觉上显示为红色虚线下划线）\n-- `color`: 标注颜色\n+  - `highlight`: 黄色背景高亮（颜色在视图层定义）\n+  - `note`: 笔记（视觉上显示为红色虚线下划线，颜色在视图层定义）\n - `myNote`: 用户笔记内容（仅 note 类型使用）\n - `createdAt`: 创建时间\n \n #### 2. AnnotationManager\n"
                }
            ],
            "date": 1762661640555,
            "name": "Commit-0",
            "content": "# EPUB 标注系统使用指南\n\n这个示例应用实现了一个完整的 EPUB 标注系统，支持高亮、笔记等功能。\n\n## 功能特性\n\n### 1. 高亮功能\n- **添加高亮**：选中文本后，在上下文菜单中选择\"高亮\"\n- **取消高亮**：如果文本已经高亮，菜单会显示\"取消高亮\"选项\n- 高亮使用黄色背景显示\n\n### 2. 笔记功能\n- **添加笔记**：选中任意文本，点击\"做笔记\"，输入笔记内容\n- **多个笔记**：同一段文字可以添加多个笔记\n- **视觉标识**：有笔记的文字会显示红色虚线下划线\n- **查看笔记**：点击带有红色虚线的文字，会弹出该位置的所有笔记列表\n- **删除笔记**：在笔记列表中，每条笔记右侧有删除按钮\n\n### 3. 持久化存储\n- 所有标注都会自动保存到本地\n- 重新打开应用时，所有标注会自动恢复\n- 使用 SharedPreferences 进行数据持久化\n\n### 4. 数据管理\n- 点击顶部工具栏的\"清除所有标注\"按钮，可以删除所有标注\n\n## 技术实现\n\n### 核心类\n\n#### 1. AppAnnotation\n定义了标注的数据模型：\n- `id`: 唯一标识符\n- `cfi`: EPUB CFI 位置信息\n- `type`: 标注类型（高亮/笔记）\n  - `highlight`: 黄色背景高亮\n  - `note`: 笔记（视觉上显示为红色虚线下划线）\n- `color`: 标注颜色\n- `myNote`: 用户笔记内容（仅 note 类型使用）\n- `createdAt`: 创建时间\n\n#### 2. AnnotationManager\n管理所有标注的生命周期：\n- 加载和保存标注\n- 添加、删除、查询标注\n- 按 CFI 查找标注\n- 检查特定位置是否有高亮或笔记\n\n#### 3. AnnotationSerializer\n处理标注的序列化和反序列化，用于持久化存储\n\n### 上下文菜单逻辑\n\n选择文本时，菜单项会动态生成：\n- 如果已经高亮 → 显示\"取消高亮\"\n- 如果未高亮 → 显示\"高亮\"\n- 始终显示\"做笔记\"选项\n\n### 点击交互\n\n点击标注时的行为：\n1. 系统检测到标注点击事件\n2. 通过 CFI 查找该位置的所有笔记\n3. 如果有笔记，弹出列表对话框\n4. 用户可以查看和删除笔记\n\n## 使用流程\n\n### 添加高亮\n1. 长按选中文字\n2. 在弹出菜单中点击\"高亮\"\n3. 文字会立即显示黄色高亮\n\n### 添加笔记\n1. 长按选中文字\n2. 在弹出菜单中点击\"做笔记\"\n3. 在对话框中输入笔记内容\n4. 点击\"保存\"\n5. 文字会显示红色虚线下划线\n\n### 查看笔记\n1. 点击带有红色虚线的文字\n2. 弹出笔记列表对话框\n3. 可以看到该位置的所有笔记及创建时间\n\n### 删除笔记\n1. 在笔记列表中点击删除按钮\n2. 如果是最后一条笔记，红色下划线会自动消失\n3. 如果还有其他笔记，下划线保留\n\n## 扩展建议\n\n可以进一步扩展的功能：\n1. 支持编辑已有笔记\n2. 支持笔记导出（Markdown, JSON 等）\n3. 支持笔记分类和标签\n4. 支持笔记搜索\n5. 支持云端同步\n6. 支持不同颜色的高亮\n7. 支持分享标注和笔记\n8. 支持笔记排序（按时间、位置等）\n\n## 注意事项\n\n1. **CFI 一致性**：确保相同的文本选区使用相同的 CFI\n2. **性能优化**：大量标注时考虑分页加载\n3. **数据备份**：重要笔记建议定期导出备份\n4. **隐私安全**：敏感内容建议加密存储\n\n"
        }
    ]
}